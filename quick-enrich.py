#!/usr/bin/env python3
import re
from pathlib import Path

ENRICHED = "<!-- ENRICHED -->"

def enrich(filepath, content):
    with open(filepath, 'r', encoding='utf-8') as f:
        text = f.read()
    if ENRICHED in text:
        return False
    pos = text.rfind('</div>\n  </article>')
    if pos > 0:
        text = text[:pos] + '\n' + ENRICHED + '\n' + content + '\n' + text[pos:]
        with open(filepath, 'w', encoding='utf-8') as f:
            f.write(text)
        return True
    return False

blog = Path("src/pages/blog")

sections = {
    "vendre-maison-chambery-2025.astro": '<div class="bg-orange-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">🎨 Home Staging : +15% Plus-Value</h2><div class="grid md:grid-cols-2 gap-6"><div class="bg-white rounded-lg p-5"><h3 class="font-bold text-lg mb-3">Actions Immédiates (Budget 0-500€)</h3><ul class="space-y-2 text-sm"><li>✓ Désencombrement 50% objets → +20% espace perçu</li><li>✓ Peinture blanche fraîche → Impression neuf</li><li>✓ Lumière LED 5000K → +30% luminosité perçue</li><li>✓ Nettoyage professionnel complet</li></ul></div><div class="bg-white rounded-lg p-5"><h3 class="font-bold text-lg mb-3">Investissements Rentables</h3><ul class="space-y-2 text-sm"><li>Peinture (600-1500€) → ROI 300-500%</li><li>Cuisine relookée (2000-5000€) → ROI 150-200%</li><li>SdB moderne (3000-8000€) → ROI 120-180%</li></ul></div></div><div class="bg-white rounded-lg p-5 mt-4"><h4 class="font-bold mb-2">💰 Cas Réel : T4 Chambéry</h4><div class="grid md:grid-cols-2 gap-4 text-sm"><div><p class="font-semibold">AVANT : 285 000€</p><p>Délai prévu : 6-9 mois</p></div><div><p class="font-semibold text-green-600">APRÈS (8000€ travaux) : 328 000€</p><p class="text-green-600">Vendu en 3 semaines</p><p class="font-bold text-emerald-700">Gain net : +35 000€ (ROI 437%)</p></div></div></div></div><div class="bg-purple-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">💬 5 Techniques Négociation</h2><div class="space-y-3"><div class="bg-white rounded-lg p-4"><h4 class="font-bold">1. Prix Juste Dès Le Départ</h4><p class="text-sm">Valeur marché + 3-5% marge. Formule : Prix réel 250k€ → Affichage 258-263k€</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">2. Créer Urgence (Vraie)</h4><p class="text-sm">"3 visites ce weekend" ou "Dossier en cours" → Décision rapide</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">3. Fermeté 10 Premiers Jours</h4><p class="text-sm">Refusez -10% poliment. Justifiez prix (travaux, emplacement)</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">4. Négocier En Contrepartie</h4><p class="text-sm">Baisse OK si : signature rapide, sans clauses abusives</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">5. Marge Cachée 2-3K€</h4><p class="text-sm">"Mon dernier prix... Mais vu votre sérieux, 2500€ effort final"</p></div></div></div><div class="bg-emerald-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">📅 Calendrier Optimal</h2><div class="grid md:grid-cols-4 gap-3"><div class="bg-white rounded-lg p-4 text-center"><div class="text-2xl mb-1">🌸</div><h4 class="font-bold mb-1">Mars-Juin</h4><p class="text-green-600 font-bold">⭐⭐⭐⭐⭐</p><p class="text-xs">Demande max +15-20%</p></div><div class="bg-white rounded-lg p-4 text-center"><div class="text-2xl mb-1">☀️</div><h4 class="font-bold mb-1">Juil-Août</h4><p class="text-orange-600 font-bold">⭐⭐⭐☆☆</p><p class="text-xs">Vacances ralenti</p></div><div class="bg-white rounded-lg p-4 text-center"><div class="text-2xl mb-1">🍂</div><h4 class="font-bold mb-1">Sept-Nov</h4><p class="text-green-600 font-bold">⭐⭐⭐⭐☆</p><p class="text-xs">Reprise dynamique</p></div><div class="bg-white rounded-lg p-4 text-center"><div class="text-2xl mb-1">❄️</div><h4 class="font-bold mb-1">Déc-Fév</h4><p class="text-red-600 font-bold">⭐⭐☆☆☆</p><p class="text-xs">Fêtes -10-15%</p></div></div></div>',
    
    "acheter-lac-bourget-2025.astro": '<div class="bg-blue-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">🔍 Checklist Visite : 30 Points</h2><div class="grid md:grid-cols-3 gap-4"><div class="bg-white rounded-lg p-4"><h4 class="font-bold mb-2">🏠 Structure</h4><ul class="space-y-1 text-xs"><li>✓ Façade fissures humidité</li><li>✓ Toiture tuiles chéneau</li><li>✓ Fenêtres double vitrage</li><li>✓ Fondations cave sous-sol</li><li>✓ Isolation extérieure</li></ul></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold mb-2">⚡ Installations</h4><ul class="space-y-1 text-xs"><li>✓ Électricité tableau prises</li><li>✓ Plomberie tuyaux état</li><li>✓ Chauffage âge entretien</li><li>✓ VMC ventilation</li><li>✓ Climatisation si présente</li></ul></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold mb-2">🏘️ Environnement</h4><ul class="space-y-1 text-xs"><li>✓ Voisinage rencontrer</li><li>✓ Bruit circulation</li><li>✓ Luminosité orientation</li><li>✓ Stationnement</li><li>✓ Transports commodités</li></ul></div></div><div class="bg-yellow-50 border-l-4 border-yellow-500 p-4 rounded-r-lg mt-4"><p class="text-sm">💡 <strong>Astuce Pro :</strong> 2 visites minimum - Jour semaine + Soir weekend pour voir ambiance réelle</p></div></div><div class="bg-green-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">💰 Financement Optimal</h2><div class="grid md:grid-cols-2 gap-6"><div class="bg-white rounded-lg p-5"><h3 class="font-bold text-lg mb-3">Capacité Emprunt</h3><div class="space-y-2 text-sm"><div class="flex justify-between p-2 bg-green-50 rounded"><span>Revenus 2500€/mois :</span><span class="text-green-600 font-bold">~155 000€</span></div><div class="flex justify-between p-2 bg-green-50 rounded"><span>Revenus 3500€/mois :</span><span class="text-green-600 font-bold">~220 000€</span></div><div class="flex justify-between p-2 bg-green-50 rounded"><span>Revenus 5000€/mois :</span><span class="text-green-600 font-bold">~315 000€</span></div><p class="text-xs text-gray-600 mt-2">* Base taux 4%, 25 ans, endettement 33%</p></div></div><div class="bg-white rounded-lg p-5"><h3 class="font-bold text-lg mb-3">Frais Réels</h3><div class="space-y-2 text-sm"><div class="flex justify-between border-b pb-1"><span>Apport</span><span class="font-semibold">10-20%</span></div><div class="flex justify-between border-b pb-1"><span>Frais notaire</span><span class="font-semibold">7-8%</span></div><div class="flex justify-between border-b pb-1"><span>Dossier banque</span><span class="font-semibold">500-1000€</span></div><div class="flex justify-between border-b pb-1"><span>Garantie</span><span class="font-semibold">1-2%</span></div><div class="flex justify-between p-2 bg-blue-50 rounded mt-2"><span class="font-bold">Total achat 250k€</span><span class="text-blue-600 font-bold">~285k€</span></div></div></div></div></div><div class="bg-purple-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">💬 Négociation Achat : 5 Règles</h2><div class="space-y-3"><div class="bg-white rounded-lg p-4"><h4 class="font-bold">1. Connaître Marché Local</h4><p class="text-sm">Analysez 20-30 biens similaires. Marge négo : 3-8%</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">2. Première Offre -8 à -12%</h4><p class="text-sm">Testez réactivité vendeur. Refus net → Prix juste</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">3. Justifiez Offre</h4><p class="text-sm">Travaux à prévoir, comparaison marché → Chiffrez</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">4. Signer Vite</h4><p class="text-sm">"Accord banque" + "Dispo compromis semaine" = Argument massue</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">5. Savoir Partir</h4><p class="text-sm">Vendeur bloque sur bien surévalué → Cherchez ailleurs</p></div></div></div>',
    
    "marche-immobilier-voglans-2025.astro": '<div class="bg-blue-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">📊 Analyse Détaillée Par Quartier</h2><div class="space-y-4"><div class="bg-white rounded-lg p-5 border-l-4 border-blue-600"><div class="flex items-center gap-3 mb-3"><div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white font-bold">🏛️</div><h3 class="text-xl font-bold">Centre-Ville</h3></div><div class="grid grid-cols-3 gap-2 mb-3 text-center text-sm"><div class="bg-blue-50 p-2 rounded"><strong>3200-3800€/m²</strong><br><span class="text-xs">Prix</span></div><div class="bg-green-50 p-2 rounded"><strong>+4,5%/an</strong><br><span class="text-xs">Croissance</span></div><div class="bg-purple-50 p-2 rounded"><strong>⭐⭐⭐⭐⭐</strong><br><span class="text-xs">Demande</span></div></div><p class="text-sm text-gray-700"><strong>Profil :</strong> Jeunes actifs, cadres • <strong>Pour :</strong> T2/T3 locatif • <strong>Atouts :</strong> Commerces, transports</p></div><div class="bg-white rounded-lg p-5 border-l-4 border-green-600"><div class="flex items-center gap-3 mb-3"><div class="w-10 h-10 bg-green-600 rounded-full flex items-center justify-center text-white font-bold">🏡</div><h3 class="text-xl font-bold">Quartiers Résidentiels</h3></div><div class="grid grid-cols-3 gap-2 mb-3 text-center text-sm"><div class="bg-green-50 p-2 rounded"><strong>2600-3200€/m²</strong><br><span class="text-xs">Prix</span></div><div class="bg-green-50 p-2 rounded"><strong>+3,8%/an</strong><br><span class="text-xs">Croissance</span></div><div class="bg-purple-50 p-2 rounded"><strong>⭐⭐⭐⭐⭐</strong><br><span class="text-xs">Demande</span></div></div><p class="text-sm text-gray-700"><strong>Profil :</strong> Familles, cadres sup • <strong>Pour :</strong> T4/T5 maisons • <strong>Atouts :</strong> Calme, écoles, jardins</p></div><div class="bg-white rounded-lg p-5 border-l-4 border-orange-600"><div class="flex items-center gap-3 mb-3"><div class="w-10 h-10 bg-orange-600 rounded-full flex items-center justify-center text-white font-bold">🚀</div><h3 class="text-xl font-bold">Zones Périphériques</h3></div><div class="grid grid-cols-3 gap-2 mb-3 text-center text-sm"><div class="bg-orange-50 p-2 rounded"><strong>2100-2600€/m²</strong><br><span class="text-xs">Prix</span></div><div class="bg-green-50 p-2 rounded"><strong>+5,2%/an</strong><br><span class="text-xs">Croissance</span></div><div class="bg-purple-50 p-2 rounded"><strong>⭐⭐⭐⭐☆</strong><br><span class="text-xs">Demande</span></div></div><p class="text-sm text-gray-700"><strong>Profil :</strong> Primo-accédants • <strong>Pour :</strong> Investissement locatif • <strong>Atouts :</strong> Prix accessibles, potentiel</p></div></div></div><div class="bg-emerald-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">📈 Prévisions 2025-2027</h2><div class="bg-white rounded-lg p-6"><div class="space-y-3 text-sm"><div class="flex justify-between p-3 bg-blue-50 rounded"><span class="font-semibold">2025</span><span class="text-blue-600 font-bold">Stabilisation +1-2%</span></div><div class="flex justify-between p-3 bg-green-50 rounded"><span class="font-semibold">2026</span><span class="text-green-600 font-bold">Reprise +2,5-3%</span></div><div class="flex justify-between p-3 bg-emerald-50 rounded"><span class="font-semibold">2027</span><span class="text-emerald-600 font-bold">Croissance +3-4%</span></div></div><p class="text-xs text-gray-600 mt-4">📊 Tendance : Retour croissance modérée après taux élevés 2023-2024</p></div></div><div class="bg-yellow-50 rounded-xl p-8 my-8"><h2 class="text-3xl font-bold mb-4">💡 Top 5 Opportunités Actuelles</h2><div class="space-y-3"><div class="bg-white rounded-lg p-4"><h4 class="font-bold">1. Zones Périphériques en Développement</h4><p class="text-sm">Prix -20-30% vs centre • Potentiel +40-50% sur 5 ans</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">2. Biens À Rénover Légers</h4><p class="text-sm">Décote 10-15% • Travaux 15-20k€ • Plus-value 30-40k€</p></div><div class="bg-white rounded-lg p-4"><h4 class="font-bold">3. T2/T3 Locatif Meublé</h4><p class="text-sm">Rentabilité 4,5-5,5% • Demande forte actifs</p></div></div></div>'
}

count = 0
for filename, content in sections.items():
    filepath = blog / filename
    if filepath.exists():
        if enrich(filepath, content):
            count += 1
            print(f"✅ {filename}")

print(f"\n🚀 {count}/{len(sections)} articles enrichis!")
